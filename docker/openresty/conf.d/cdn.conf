server {
    listen       80;
    server_name  cdn.kelu.org;

    access_log off; #access_log end
    error_log off; #error_log end

    root /var/www/cdn;
    index index.html;

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
    {
        valid_referers none *.qpic.cn *.kelu.org *.qq.com *.google.com *.baidu.com *.sinaimg.cn localhost 10.0.75.2 47.96.79.77;
        if ($invalid_referer) {
            rewrite ^/ https://wx3.sinaimg.cn/mw690/7b736eb7ly1fjr44z6lesj21hc0rs77f.jpg;
            #return 404;
        }
        expires      30d;
    }
}

server {
    listen       443;
    server_name  cdn.kelu.org;

    access_log off; #access_log end
    error_log off; #error_log end

    ssl on;
    ssl_certificate /etc/letsencrypt/live/cdn.kelu.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/cdn.kelu.org/privkey.pem;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers AESGCM:ALL:!DH:!EXPORT:!RC4:+HIGH:!MEDIUM:!LOW:!aNULL:!eNULL;
    ssl_prefer_server_ciphers on;

    root /var/www/cdn;
    index index.html;

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
    {
        valid_referers none *.qpic.cn *.kelu.org *.qq.com *.google.com *.baidu.com *.sinaimg.cn localhost 10.0.75.2 47.96.79.77;
        if ($invalid_referer) {
            rewrite ^/ https://wx3.sinaimg.cn/mw690/7b736eb7ly1fjr44z6lesj21hc0rs77f.jpg;
            #return 404;
        }
        expires      30d;
    }
}
